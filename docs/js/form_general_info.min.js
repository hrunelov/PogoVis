/*! PogoVis v0.0.1 | (c) 2020 Hannes Runel√∂v | MIT License |  */
var typeChar,evoFadeDelays=0;function updateGeneralInfo(){updateTopBar(),updateTypeInfo(),updateEvolution()}function updateDescription(){if(!lastForm||lastForm.description!==selectedForm.description){d3.select("#form-description-body").html("<u>"+selectedForm.description+"</u>"),animateHeight("#form-description-body"),clearInterval(typeChar);var e=0;typeChar=setInterval((function(){(e+=2)>selectedForm.description.length&&(e=selectedForm.description.length),d3.select("#form-description-body").html(selectedForm.description.substring(0,e)+"<u>"+selectedForm.description.substring(e)+"</u>"),e===selectedForm.description.length&&clearInterval(typeChar)}),0)}}function updateTopBar(){d3.select("#form-female-percent").text(void 0!==selectedForm.femaleToMaleRatio?oneDecimal(100*selectedForm.femaleToMaleRatio)+"%":"");let e=1===selectedForm.femaleToMaleRatio?1.01:selectedForm.femaleToMaleRatio,t=d3.select("#form-female-bar").style("z-index",e>=1?1:0),a=100*e+"%";lastForm&&void 0!==lastForm.femaleToMaleRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",a):t.style("width",a),t=d3.select("#form-male-bar").style("z-index",0===e?1:0),a=100-100*Math.min(e,1)+"%",lastForm&&void 0!==lastForm.femaleToMaleRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",a):t.style("width",a),d3.selectAll(".form-gender-element").classed("hidden",void 0===selectedForm.femaleToMaleRatio),d3.select("#form-genderless-label").classed("hidden",void 0!==selectedForm.femaleToMaleRatio),d3.select("#form-male-percent").text(void 0!==selectedForm.femaleToMaleRatio?100-oneDecimal(100*selectedForm.femaleToMaleRatio)+"%":"")}function updateTypeInfo(){if(!lastForm||!lastForm.sameTyping(selectedForm,!0)){listData({data:selectedForm.types,key:e=>e.key,container:d3.select("#form-types"),classed:"type-label",horizontal:!0,hideContent:!1,fade:!1,waitForExit:!0,onenter:function(e,t){e.classed("type-label",!0),e.appendTypeIcon().zoomIn({delay:t,ease:d3.easeBackOut}),e.append("div").classed("uppercase-label",!0).classed("type-name",!0).text(e=>e.name).zoomInY({delay:t,fade:!0}),selectedForm.types.length>1&&e.style("width","17.5%")},onexit:function(e,t){e.select(".type-icon").interrupt().zoomOut({delay:t,ease:d3.easeBackIn}),e.select(".type-name").interrupt().zoomOutY({delay:t,fade:!0})}});var e=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier<1).sort((e,t)=>e.damageMultiplier-t.damageMultiplier),t=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier>1).sort((e,t)=>t.damageMultiplier-e.damageMultiplier);listTypeEffectivenesses(e,"#form-resistances",!0),listTypeEffectivenesses(t,"#form-weaknesses",!1)}}function listTypeEffectivenesses(e,t,a){const o=48;listData({data:e,key:e=>e.attackingType.key,container:d3.select(t),classed:"form-type-effectiveness-label-wrapper",hideContent:!1,fade:!1,waitForExit:!0,onenter:function(e,t){(e=e.append("div").classed("form-type-effectiveness-label",!0).classed("reverse",a).attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks").style("width","48px").style("background","#222")).appendTypeIcon(e=>e.attackingType).zoomIn({delay:t}),e.append("div").classed("numeric-label",!0).classed("form-type-effectiveness-percent",!0).text(e=>oneDecimal(100*e.damageMultiplier)+"%").zoomInY({delay:t,fade:!0}),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay((e,a)=>t(e,a)+TRANSITION_DURATION_MEDIUM/3).style("background",e=>mixColors("#000",e.attackingType.color,.66)).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.boundary.combinedTypeDamageMultiplier.max:(1-e.damageMultiplier)/(1-1/pokedex.boundary.combinedTypeDamageMultiplier.max))+o+"px")},onupdate:function(e,t){let a=(e,a)=>t(e,a)+TRANSITION_DURATION_MEDIUM/3;(e=e.select(".form-type-effectiveness-label").attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks")).select(".form-type-effectiveness-percent").delay(a).text(e=>oneDecimal(100*e.damageMultiplier)+"%"),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay(a).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.boundary.combinedTypeDamageMultiplier.max:(1-e.damageMultiplier)/(1-1/pokedex.boundary.combinedTypeDamageMultiplier.max))+o+"px")},onexit:function(e,t){(e=e.select(".form-type-effectiveness-label")).select(".type-icon").interrupt().zoomOut({delay:t}),e.select(".form-type-effectiveness-percent").interrupt().zoomOutY({delay:t,fade:!0}),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay(t).style("background","#222").style("width","48px")}})}function updateEvolution(){if(d3.select("#form-evolution-root").selectAll("div").remove(),!selectedForm.firstAncestor.evolutions)return d3.select("#form-evolution-root").html("<br/>No known lineage"),void animateHeight("#form-evolution-body");d3.select("#form-evolution-root").text("");let e=!lastForm||!equivalent(lastForm.firstAncestor.evolutions,selectedForm.firstAncestor.evolutions,"descendant");if(e){d3.select("#form-evolution-root").interrupt().style("transform","scaleX(0)").transition().duration(TRANSITION_DURATION_MEDIUM).ease(d3.easeBack).style("transform","scaleX(1)")}let a=0;evoFadeDelays=0,(function o(s,d,i){const n=TRANSITION_DURATION_MEDIUM/2;i||(a=0,i=1),i>a&&(a=i);let r=s.append("div").classed("form-evolution-column",!0),c=r.appendPokemonImage({form:d,selected:d.key===selectedForm.key,fadeDelay:n+TRANSITION_DELAY/2*evoFadeDelays++,fadeFrame:e,fadeImage:e,onclick:function(){setSelectedPokemon(d.pokemon,d.pokemon.forms.indexOf(d))}}).classed("form-evolution-descendant-image-wrapper",!0);if(c.append("div").classed("form-evolution-descendant-line",!0),!d.evolutions)return;let m=[];for(let e of d.evolutions){if(m.find(t=>t.includes(e)))continue;let t=[e];for(let a of d.evolutions)t.includes(a)||equivalent(e,a,["descendant","evolutionType"])&&t.push(a);m.push(t)}m.length>1&&((r=s.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("medium",!0).classed("upper",!0),r.append("div").classed("form-evolution-path",!0).classed("medium",!0).classed("lower",!0)),r=s.append("div").classed("form-evolution-column",!0);for(let a=0;a<m.length;++a){const s=m[a],d=s[0],p=m.length>1,u=p&&0==a,f=p&&a==m.length-1;let v=r.append("div").classed("form-evolution-row",!0),y=v.append("div").classed("form-evolution-column",!0);y.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",p).classed("top",u).classed("bottom",f),y.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",p).classed("top",u).classed("bottom",f),(y=v.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("full",!0).classed("upper",!0).classed("top",u).classed("bottom",f),y.append("div").classed("form-evolution-path",!0).classed("full",!0).classed("lower",!0).classed("top",u).classed("bottom",f);let g=y.append("div").classed("form-evolution-reqs-wrapper",!0).append("div").classed("form-evolution-reqs-body",!0);if(d.requirements.item||d.requirements.timeOfDay||d.requirements.gender){let t=g.append("div").classed("form-evolution-req-icons-wrapper",!0);if(d.requirements.gender){let a=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+d.requirements.gender+".svg").attr("title",capitalize(d.requirements.gender)+" only");e&&fadeInIcon(a,n+TRANSITION_DELAY/2*evoFadeDelays++)}if(d.requirements.item){let a=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/items/"+d.requirements.item.key+".png").attr("title","Requires "+d.requirements.item.name);e&&fadeInIcon(a,n+TRANSITION_DELAY/2*evoFadeDelays++)}if(d.requirements.timeOfDay){let a=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+d.requirements.timeOfDay+".svg").attr("title","Only during the "+d.requirements.timeOfDay);e&&fadeInIcon(a,n+TRANSITION_DELAY/2*evoFadeDelays++)}}if(d.requirements.buddyDistance){let t=g.append("div").classed("form-evolution-req-label",!0).attr("title","Must be buddy and walked "+d.requirements.buddyDistance+" km first"),a=t.append("img").attr("src","img/distance.svg");e&&fadeInIcon(a,n+TRANSITION_DELAY/2*evoFadeDelays++);let o=t.append("div").classed("form-evolution-req-number",!0).text(d.requirements.buddyDistance+" km");e&&fadeInText(o,n+TRANSITION_DELAY/2*evoFadeDelays)}if(d.requirements.highestStat){let t=g.append("div").classed("form-evolution-req-label",!0).attr("title","Highest stat is "+d.requirements.highestStat).append("div").classed("form-evolution-req-text",!0).text(d.requirements.highestStat);e&&fadeInText(t,n+TRANSITION_DELAY/2*evoFadeDelays)}if(d.requirements.megaEnergy){let t=g.append("div").classed("form-evolution-req-label",!0).attr("title","Requires "+d.requirements.megaEnergy.first+" Mega Energy first, "+d.requirements.megaEnergy.subsequent+" afterwards"),a=t.append("img").attr("src","img/mega.svg");e&&fadeInIcon(a,n+TRANSITION_DELAY/2*evoFadeDelays++);let o=t.append("div").classed("form-evolution-req-number",!0).html(d.requirements.megaEnergy.first+"<br/>ü°ñ"+d.requirements.megaEnergy.subsequent);e&&fadeInText(o,n+TRANSITION_DELAY/2*evoFadeDelays)}if(d.requirements.candy){let t=g.append("div").classed("form-evolution-req-label",!0).attr("title","Requires "+d.requirements.candy+" candy"),a=t.append("img").attr("src","img/candy.svg");e&&fadeInIcon(a,n+TRANSITION_DELAY/2*evoFadeDelays++);let o=t.append("div").classed("form-evolution-req-number",!0).text(d.requirements.candy);e&&fadeInText(o,n+TRANSITION_DELAY/2*evoFadeDelays)}if(d.tradeDiscount&&(l=g.append("div").classed("form-evolution-req-label",!0).attr("title","No candy requirement if traded"),t=l.append("div").classed("form-evolution-req-number",!0).html("or&nbsp;&nbsp;"),e&&fadeInText(t,n+TRANSITION_DELAY/2*evoFadeDelays),c=l.append("img").attr("src","img/trade.svg"),e&&fadeInIcon(c,n+TRANSITION_DELAY/2*evoFadeDelays++)),(y=v.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("top",u).classed("bottom",f),y.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("top",u).classed("bottom",f),s.length>1){y=v.append("div").classed("form-evolution-column",!0);let e=v.append("div").classed("form-evolution-column",!0);for(let t=0;t<s.length;++t){const a=s[t],l=0==t,d=t==s.length-1;y.append("div").classed("form-evolution-path",!0).classed("medium",!0).classed("upper",!0).classed("split",!0).classed("top",l).classed("bottom",d),y.append("div").classed("form-evolution-path",!0).classed("medium",!0).classed("lower",!0).classed("split",!0).classed("top",l).classed("bottom",d),o(e.append("div").classed("form-evolution-row",!0),a.descendant,i+1)}}else o(v,d.descendant,i+1)}})(d3.select("#form-evolution-root"),selectedForm.firstAncestor),d3.select("#form-evolution-body").classed("overflow",a>3),animateHeight("#form-evolution-body")}