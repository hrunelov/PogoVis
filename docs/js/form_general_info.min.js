/*! PogoVis v0.0.1 | (c) 2020 Hannes RunelÃ¶v | MIT License |  */
var typeChar,evoFadeDelays=0;function updateGeneralInfo(){updateTopBar(),updateTypeInfo(),updateEvolution()}function updateDescription(){}var lastW=0,lastH=0;function updateTopBar(){function e(e,t){return t?(2*Math.atan(t/e)-.5*Math.PI)/(.5*Math.PI):1}d3.select("#form-height-icon").transition().duration(TRANSITION_DURATION_MEDIUM).style("height",100*Math.min(PERSON_HEIGHT/selectedForm.height,1)+"%"),d3.select("#form-height-bar").transition().duration(TRANSITION_DURATION_MEDIUM).style("height",100*Math.min(selectedForm.height/PERSON_HEIGHT,1)+"%"),d3.select("#form-height-label").text(selectedForm.height+" m").transition().duration(TRANSITION_DURATION_MEDIUM).style("height",100*Math.min(selectedForm.height/PERSON_HEIGHT,1)+"%");let t=22*e(PERSON_WEIGHT,selectedForm.weight)+22,a=22*e(selectedForm.weight,PERSON_WEIGHT)+22;d3.select("#form-weight-person").transition().duration(TRANSITION_DURATION_MEDIUM).style("margin-bottom",t+"px"),d3.select("#form-weight-pokemon").transition().duration(TRANSITION_DURATION_MEDIUM).style("margin-bottom",a+"px"),d3.select("#form-weight-label").text(selectedForm.weight+" kg");let o=getRatio(selectedForm.femaleToMaleRatio);d3.select("#form-female-ratio").text(void 0!==selectedForm.femaleToMaleRatio?o[0]:"");let l=1===selectedForm.femaleToMaleRatio?1.01:selectedForm.femaleToMaleRatio,i=d3.select("#form-female-bar").style("z-index",l>=1?1:0),n=100*l+"%";lastForm&&void 0!==lastForm.femaleToMaleRatio?i.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",n):i.style("width",n),i=d3.select("#form-male-bar").style("z-index",0===l?1:0),n=100-100*Math.min(l,1)+"%",lastForm&&void 0!==lastForm.femaleToMaleRatio?i.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",n):i.style("width",n),d3.selectAll(".form-gender-element").classed("hidden",void 0===selectedForm.femaleToMaleRatio),d3.select("#form-genderless-label").classed("hidden",void 0!==selectedForm.femaleToMaleRatio),d3.select("#form-male-ratio").text(void 0!==selectedForm.femaleToMaleRatio?o[1]:"")}function updateTypeInfo(){if(!lastForm||!lastForm.sameTyping(selectedForm,!0)){d3.select("#form-types").listData({duration:selectedPageIndex===PAGE_GENERAL?void 0:0,data:selectedForm.types,key:e=>e.key,horizontal:!0,hideContent:!1,fade:!1,waitForExit:!0,onenter:function(e,t){e.classed("type-label",!0),e.appendTypeIcon().zoomIn({delay:t,ease:d3.easeBackOut}),e.append("div").classed("uppercase-label",!0).classed("type-name",!0).text(e=>e.name).fadeIn({delay:t}),selectedForm.types.length>1&&e.style("width","17.5%")},onexit:function(e,t){e.select(".type-icon").interrupt().zoomOut({delay:t,ease:d3.easeBackIn}),e.select(".type-name").interrupt().fadeOut({delay:t})}}).classed("type-label",!0);var e=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier<1).sort((e,t)=>e.damageMultiplier-t.damageMultiplier),t=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier>1).sort((e,t)=>t.damageMultiplier-e.damageMultiplier);listTypeEffectivenesses(e,"#form-resistances",!0),listTypeEffectivenesses(t,"#form-weaknesses",!1)}}function listTypeEffectivenesses(e,t,a){const o=48;d3.select(t).listData({duration:selectedPageIndex===PAGE_GENERAL?void 0:0,data:e,key:e=>e.attackingType.key,hideContent:!1,fade:!1,waitForExit:!0,onenter:function(e,t){(e=e.append("div").classed("form-type-effectiveness-label",!0).classed("reverse",a).attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks").style("width","48px").style("background","#222")).appendTypeIcon(e=>e.attackingType).zoomIn({delay:t}),e.append("div").classed("numeric-label",!0).classed("form-type-effectiveness-percent",!0).text(e=>oneDecimal(100*e.damageMultiplier)+"%").fadeIn({delay:t}),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay((e,a)=>t(e,a)+TRANSITION_DURATION_MEDIUM/3).style("background",e=>mixColors("#000",e.attackingType.color,.66)).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.boundary.combinedTypeDamageMultiplier.max:(1-e.damageMultiplier)/(1-1/pokedex.boundary.combinedTypeDamageMultiplier.max))+o+"px")},onupdate:function(e,t){let a=(e,a)=>t(e,a)+TRANSITION_DURATION_MEDIUM/3;(e=e.select(".form-type-effectiveness-label").attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks")).select(".form-type-effectiveness-percent").delay(a).text(e=>oneDecimal(100*e.damageMultiplier)+"%"),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay(a).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.boundary.combinedTypeDamageMultiplier.max:(1-e.damageMultiplier)/(1-1/pokedex.boundary.combinedTypeDamageMultiplier.max))+o+"px")},onexit:function(e,t){(e=e.select(".form-type-effectiveness-label")).select(".type-icon").interrupt().zoomOut({delay:t}),e.select(".form-type-effectiveness-percent").interrupt().fadeOut({delay:t}),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay(t).style("background","#222").style("width","48px")}}).classed("form-type-effectiveness-label-wrapper",!0)}function updateEvolution(){if(d3.select("#form-evolution-body").selectAll("div").remove(),!selectedForm.firstAncestor.evolutions&&!selectedForm.pokemon.relatives)return d3.select("#form-evolution-body").append("div").classed("form-evolution-root",!0).html("<br/>No known lineage"),void animateHeight("#form-evolution-body");let e=!lastForm||!equivalent(lastForm.firstAncestor.evolutions,selectedForm.firstAncestor.evolutions,"descendant");if(e){d3.select("#form-evolution-root").interrupt().style("transform","scaleX(0)").transition().duration(TRANSITION_DURATION_MEDIUM).ease(d3.easeBack).style("transform","scaleX(1)")}let a,o=[];if(o.push(selectedForm.firstAncestor),selectedPokemon.relatives)for(let e of selectedPokemon.relatives){let t=e.forms.find(e=>e.name===selectedForm.name);t||(t=e.forms[0]),t=t.firstAncestor,o.find(e=>e.key===t.key)||o.push(t)}function i(o,n,s){const r=TRANSITION_DURATION_MEDIUM/2;function d(e,t,a,o,l,i){let n=e.appendSvg().classed("form-evolution-path",!0).classed(t,!0).append("g");if(a){n.append("rect").classed("form-evolution-path-line",!0).classed("dashed",i).attr("y",o?"50%":"-50%").attr("width","200%").attr("height",l?"100%":"200%")}a&&(o||l)||n.append("line").classed("form-evolution-path-line",!0).classed("dashed",i).attr("x1",0).attr("x2","100%").attr("y1","50%").attr("y2","50%")}s||(a=0,s=1),s>a&&(a=s);let m=o.append("div").classed("form-evolution-column",!0),c=m.appendPokemonImage({form:n,selected:n.key===selectedForm.key,fadeDelay:r+TRANSITION_DELAY/2*evoFadeDelays++,fadeFrame:e,fadeImage:e,onclick:function(){setSelectedPokemon(n.pokemon,n.pokemon.forms.indexOf(n))}}).classed("form-evolution-descendant-image-wrapper",!0);if(c.append("div").classed("form-evolution-descendant-line",!0),!n.evolutions)return;let p=[];for(let e of n.evolutions){if(p.find(t=>t.includes(e)))continue;let t=[e];for(let a of n.evolutions)t.includes(a)||equivalent(e,a,["descendant","evolutionType"])&&t.push(a);p.push(t)}p.length>1&&d(m=o.append("div").classed("form-evolution-column",!0),"medium"),m=o.append("div").classed("form-evolution-column",!0);for(let a=0;a<p.length;++a){const o=p[a],n=o[0],u=p.length>1,f=u&&0==a,v=u&&a==p.length-1,y=!!n.evolutionType;let I=m.append("div").classed("form-evolution-row",!0),g=I.append("div").classed("form-evolution-column",!0);d(g,"short",u,f,v,y),d(g=I.append("div").classed("form-evolution-column",!0),"full",!1,!1,!1,y);let T=g.append("div").classed("form-evolution-reqs-wrapper",!0).append("div").classed("form-evolution-reqs-body",!0);if(n.requirements.item||n.requirements.timeOfDay||n.requirements.gender){let t=T.append("div").classed("form-evolution-req-icons-wrapper",!0);if(n.requirements.gender){let a=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.gender+".svg").attr("title",capitalize(n.requirements.gender)+" only");e&&fadeInIcon(a,r+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.item){let a=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/items/"+n.requirements.item.key+".png").attr("title","Requires "+n.requirements.item.name);e&&fadeInIcon(a,r+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.timeOfDay){let a=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.timeOfDay+".svg").attr("title","Only during the "+n.requirements.timeOfDay);e&&fadeInIcon(a,r+TRANSITION_DELAY/2*evoFadeDelays++)}}if(n.requirements.buddyDistance){let t=T.append("div").classed("form-evolution-req-label",!0).attr("title","Must be buddy and walked "+n.requirements.buddyDistance+" km first"),a=t.append("img").attr("src","img/distance.svg");e&&fadeInIcon(a,r+TRANSITION_DELAY/2*evoFadeDelays++);let o=t.append("div").classed("form-evolution-req-number",!0).text(n.requirements.buddyDistance+" km");e&&fadeInText(o,r+TRANSITION_DELAY/2*evoFadeDelays)}if(n.requirements.highestStat){let t=T.append("div").classed("form-evolution-req-label",!0).attr("title","Highest stat is "+n.requirements.highestStat).append("div").classed("form-evolution-req-text",!0).text(n.requirements.highestStat);e&&fadeInText(t,r+TRANSITION_DELAY/2*evoFadeDelays)}if(n.requirements.megaEnergy){let t=T.append("div").classed("form-evolution-req-label",!0).attr("title","Requires "+n.requirements.megaEnergy.first+" Mega Energy first, "+n.requirements.megaEnergy.subsequent+" afterwards"),a=t.append("img").attr("src","img/mega.svg");e&&fadeInIcon(a,r+TRANSITION_DELAY/2*evoFadeDelays++);let o=t.append("div").classed("form-evolution-req-number",!0).html(n.requirements.megaEnergy.first+"<br/>>"+n.requirements.megaEnergy.subsequent);e&&fadeInText(o,r+TRANSITION_DELAY/2*evoFadeDelays)}if(n.requirements.candy){let t=T.append("div").classed("form-evolution-req-label",!0).attr("title","Requires "+n.requirements.candy+" candy"),a=t.append("img").attr("src","img/candy.svg");e&&fadeInIcon(a,r+TRANSITION_DELAY/2*evoFadeDelays++);let o=t.append("div").classed("form-evolution-req-number",!0).text(n.requirements.candy);e&&fadeInText(o,r+TRANSITION_DELAY/2*evoFadeDelays)}if(n.tradeDiscount&&(l=T.append("div").classed("form-evolution-req-label",!0).attr("title","No candy requirement if traded"),t=l.append("div").classed("form-evolution-req-number",!0).html("or&nbsp;&nbsp;"),e&&fadeInText(t,r+TRANSITION_DELAY/2*evoFadeDelays),c=l.append("img").attr("src","img/trade.svg"),e&&fadeInIcon(c,r+TRANSITION_DELAY/2*evoFadeDelays++)),d(g=I.append("div").classed("form-evolution-column",!0),"short",!1,!1,!1,y),o.length>1){g=I.append("div").classed("form-evolution-column",!0);let e=I.append("div").classed("form-evolution-column",!0);for(let t=0;t<o.length;++t){const a=o[t];d(g,"medium",!0,0==t,t==o.length-1,y),i(e.append("div").classed("form-evolution-row",!0),a.descendant,s+1)}}else i(I,n.descendant,s+1)}}o.sort((e,t)=>e.pokemon.id-t.pokemon.id),evoFadeDelays=0;let n=!1,s=!1;for(let e of o){let t=d3.select("#form-evolution-body").append("div").classed("form-evolution-root",!0).classed("form-evolution-row",!0);a=0,i(t,e),a>1&&(s=!0),a>3&&(n=!0,t.classed("overflow",!0))}d3.select("#form-evolution-body").classed("with-evolutions",s).classed("overflow",n),animateHeight("#form-evolution-body")}