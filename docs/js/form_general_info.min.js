/*! PogoVis v0.0.1 | (c) 2020 Hannes Runel√∂v | MIT License |  */
var typeChar,evoFadeDelays=0;function updateGeneralInfo(){updateDescription(),updateTopBar(),updateTypeInfo(),updateEvolution()}function updateDescription(){if(!lastForm||lastForm.description!==selectedForm.description){d3.select("#form-description-body").html("<u>"+selectedForm.description+"</u>"),animateHeight("#form-description-body"),clearInterval(typeChar);var e=0;typeChar=setInterval((function(){(e+=2)>selectedForm.description.length&&(e=selectedForm.description.length),d3.select("#form-description-body").html(selectedForm.description.substring(0,e)+"<u>"+selectedForm.description.substring(e)+"</u>"),e===selectedForm.description.length&&clearInterval(typeChar)}),0)}}function updateTopBar(){d3.select("#form-female-percent").text(null!==selectedForm.genderRatio?oneDecimal(100*selectedForm.genderRatio)+"%":"");let e=1===selectedForm.genderRatio?1.01:selectedForm.genderRatio,t=d3.select("#form-female-bar").style("z-index",e>=1?1:0),o=100*e+"%";lastForm&&null!==lastForm.genderRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",o):t.style("width",o),t=d3.select("#form-male-bar").style("z-index",0===e?1:0),o=100-100*Math.min(e,1)+"%",lastForm&&null!==lastForm.genderRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",o):t.style("width",o),d3.selectAll(".form-gender-element").classed("hidden",null===selectedForm.genderRatio),d3.select("#form-genderless-label").classed("hidden",null!==selectedForm.genderRatio),d3.select("#form-male-percent").text(null!==selectedForm.genderRatio?100-oneDecimal(100*selectedForm.genderRatio)+"%":"")}function updateTypeInfo(){if(!lastForm||!lastForm.sameTyping(selectedForm,!0)){listData({data:selectedForm.types,key:e=>e.key,container:d3.select("#form-types"),classed:"type-label",horizontal:!0,fade:!1,waitForExit:!0,duration:TRANSITION_DURATION_MEDIUM,onenter:function(e,t){e.classed("type-label",!0),e.appendTypeIcon().zoomIn({duration:TRANSITION_DURATION_MEDIUM,delay:t,ease:d3.easeBackOut}),e.append("div").classed("type-name",!0).text(e=>e.name).zoomInY({duration:TRANSITION_DURATION_MEDIUM,delay:t,fade:!0}),selectedForm.types.length>1&&e.style("width","17.5%")},onexit:function(e,t){e.select(".type-icon").interrupt().zoomOut({duration:TRANSITION_DURATION_MEDIUM,delay:t,ease:d3.easeBackIn}),e.select(".type-name").interrupt().zoomOutY({duration:TRANSITION_DURATION_MEDIUM,delay:t,fade:!0})}});var e=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier<1).sort((e,t)=>e.damageMultiplier-t.damageMultiplier),t=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier>1).sort((e,t)=>t.damageMultiplier-e.damageMultiplier);listTypeEffectivenesses(e,"#form-resistances",!0),listTypeEffectivenesses(t,"#form-weaknesses",!1)}}function listTypeEffectivenesses(e,t,o){const a=48;listData({data:e,key:e=>e.attackingType.key,container:d3.select(t),classed:"form-type-effectiveness-label-wrapper",fade:!1,waitForExit:!0,duration:TRANSITION_DURATION_MEDIUM,onenter:function(e,t){(e=e.append("div").classed("form-type-effectiveness-label",!0).classed("reverse",o).attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks").style("width","48px").style("background","#222")).appendTypeIcon(e=>e.attackingType).zoomIn({duration:TRANSITION_DURATION_MEDIUM,delay:t,ease:d3.easeBackOut}),e.append("div").classed("form-type-effectiveness-percent",!0).text(e=>oneDecimal(100*e.damageMultiplier)+"%").zoomInY({duration:TRANSITION_DURATION_MEDIUM,delay:t,fade:!0}),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay((e,o)=>t(e,o)+TRANSITION_DURATION_MEDIUM/3).style("background",e=>mixColors("#000",e.attackingType.color,.66)).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.maxDamageMultiplier:(1-e.damageMultiplier)/(1-1/pokedex.maxDamageMultiplier))+a+"px")},onupdate:function(e,t){let o=(e,o)=>t(e,o)+TRANSITION_DURATION_MEDIUM/3;(e=e.select(".form-type-effectiveness-label").attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks")).select(".form-type-effectiveness-percent").delay(o).text(e=>oneDecimal(100*e.damageMultiplier)+"%"),e.interrupt().transition().duration(TRANSITION_DURATION_MEDIUM).delay(o).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.maxDamageMultiplier:(1-e.damageMultiplier)/(1-1/pokedex.maxDamageMultiplier))+a+"px")},onexit:function(e,t){(e=e.select(".form-type-effectiveness-label")).select(".type-icon").interrupt().zoomOut({duration:TRANSITION_DURATION_MEDIUM,delay:t,ease:d3.easeBackIn}),e.select(".form-type-effectiveness-percent").interrupt().zoomOutY({duration:TRANSITION_DURATION_MEDIUM,delay:t,fade:!0}),e.transition().duration(TRANSITION_DURATION_MEDIUM).delay(t).style("background","#222").style("width","48px")}})}function updateEvolution(){if(d3.select("#form-evolution-root").selectAll("div").remove(),0===selectedForm.firstAncestor.evolutions.length)return d3.select("#form-evolution-root").html("<br/>No known lineage"),void animateHeight("#form-evolution-body");d3.select("#form-evolution-root").text("");let e=!lastForm||!equivalent(lastForm.firstAncestor.evolutions,selectedForm.firstAncestor.evolutions,"descendant");if(e){d3.select("#form-evolution-root").interrupt().style("transform","scaleX(0)").transition().duration(TRANSITION_DURATION_MEDIUM).ease(d3.easeBack).style("transform","scaleX(1)")}var t=function(o,a){const s=TRANSITION_DURATION_MEDIUM/2;let l=o.append("div").classed("form-evolution-column",!0);if(makePokemonImage(l,{form:a,selected:a.key===selectedForm.key,fadeDelay:s+TRANSITION_DELAY/2*evoFadeDelays++,fadeFrame:e,fadeImage:e,onclick:function(){setSelectedPokemon(a.pokemon,a.pokemon.forms.indexOf(a))}}).classed("form-evolution-descendant-image-wrapper",!0).append("div").classed("form-evolution-descendant-line",!0),0==a.evolutions.length)return;let d=[];for(let e of a.evolutions){if(d.find(t=>t.includes(e)))continue;let t=[e];for(let o of a.evolutions)t.includes(o)||equivalent(e,o,["descendant"])&&t.push(o);d.push(t)}d.length>1&&((l=o.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0),l.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0)),l=o.append("div").classed("form-evolution-column",!0);for(let o=0;o<d.length;++o){const a=d[o],n=a[0],i=d.length>1,r=i&&0==o,c=i&&o==d.length-1;let p=l.append("div").classed("form-evolution-row",!0),m=p.append("div").classed("form-evolution-column",!0);m.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",i).classed("top",r).classed("bottom",c),m.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",i).classed("top",r).classed("bottom",c),(m=p.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("full",!0).classed("upper",!0).classed("top",r).classed("bottom",c),m.append("div").classed("form-evolution-path",!0).classed("full",!0).classed("lower",!0).classed("top",r).classed("bottom",c);let u=m.append("div").classed("form-evolution-reqs-wrapper",!0).append("div").classed("form-evolution-reqs-body",!0);if(n.requirements.item||n.requirements.timeOfDay||n.requirements.gender){let t=u.append("div").classed("form-evolution-req-icons-wrapper",!0);if(n.requirements.item){let o=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/items/"+n.requirements.item.key+".svg");e&&fadeInIcon(o,s+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.timeOfDay){let o=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.timeOfDay+".svg");e&&fadeInIcon(o,s+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.gender){let o=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.gender+".svg");e&&fadeInIcon(o,s+TRANSITION_DELAY/2*evoFadeDelays++)}}if(n.requirements.buddyDistance){let t=u.append("div").classed("form-evolution-req-label",!0),o=t.append("img").attr("src","img/distance.svg");e&&fadeInIcon(o,s+TRANSITION_DELAY/2*evoFadeDelays++);let a=t.append("div").classed("form-evolution-req-number",!0).text(n.requirements.buddyDistance+" km");e&&fadeInText(a,s+TRANSITION_DELAY/2*evoFadeDelays)}if(n.requirements.other){let t=u.append("div").classed("form-evolution-req-text",!0).text(n.requirements.other);e&&fadeInText(t,s+TRANSITION_DELAY/2*evoFadeDelays)}let f=u.append("div").classed("form-evolution-req-label",!0),I=f.append("img").attr("src","img/candy.svg");e&&fadeInIcon(I,s+TRANSITION_DELAY/2*evoFadeDelays++);let v=f.append("div").classed("form-evolution-req-number",!0).text(n.requirements.candy);if(e&&fadeInText(v,s+TRANSITION_DELAY/2*evoFadeDelays),(m=p.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("top",r).classed("bottom",c),m.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("top",r).classed("bottom",c),a.length>1){m=p.append("div").classed("form-evolution-column",!0);let e=p.append("div").classed("form-evolution-column",!0);for(let o=0;o<a.length;++o){const s=a[o],l=0==o,d=o==a.length-1;m.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",!0).classed("top",l).classed("bottom",d),m.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",!0).classed("top",l).classed("bottom",d),t(e.append("div").classed("form-evolution-row",!0),s.descendant)}}else t(p,n.descendant)}};evoFadeDelays=0,t(d3.select("#form-evolution-root"),selectedForm.firstAncestor),animateHeight("#form-evolution-body")}