/*! PogoVis v0.0.1 | (c) 2020 Hannes Runel√∂v | MIT License |  */
var typeChar,evoFadeDelays=0;function updateGeneralInfo(){updateDescription(),updateTopBar(),updateTypeInfo(),updateEvolution()}function updateDescription(){if(!lastForm||lastForm.description!==selectedForm.description){d3.select("#form-description-body").html("<u>"+selectedForm.description+"</u>"),animateHeight("#form-description-body"),clearInterval(typeChar);var e=0;typeChar=setInterval((function(){(e+=2)>selectedForm.description.length&&(e=selectedForm.description.length),d3.select("#form-description-body").html(selectedForm.description.substring(0,e)+"<u>"+selectedForm.description.substring(e)+"</u>"),e===selectedForm.description.length&&clearInterval(typeChar)}),0)}}function updateTopBar(){d3.select("#form-female-percent").text(null!==selectedForm.genderRatio?oneDecimal(100*selectedForm.genderRatio)+"%":"");let e=1===selectedForm.genderRatio?1.01:selectedForm.genderRatio,t=d3.select("#form-female-bar").style("z-index",e>=1?1:0),s=100*e+"%";lastForm&&null!==lastForm.genderRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",s):t.style("width",s),t=d3.select("#form-male-bar").style("z-index",0===e?1:0),s=100-100*Math.min(e,1)+"%",lastForm&&null!==lastForm.genderRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",s):t.style("width",s),d3.selectAll(".form-gender-element").classed("hidden",null===selectedForm.genderRatio),d3.select("#form-genderless-label").classed("hidden",null!==selectedForm.genderRatio),d3.select("#form-male-percent").text(null!==selectedForm.genderRatio?100-oneDecimal(100*selectedForm.genderRatio)+"%":"")}function updateTypeInfo(){if(lastForm&&lastForm.sameTyping(selectedForm,!0))return;d3.select("#form-types").selectAll("div").remove();let e=makeTypeLabel(d3.select("#form-types").selectAll("div").data(selectedForm.types).enter(),{reverse:null,fadeDelay:2*TRANSITION_DELAY});if(selectedForm.types.length>1&&e.style("width","17.5%"),!lastForm||!lastForm.sameTyping(selectedForm,!1)){var t=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier<1).sort((e,t)=>e.damageMultiplier-t.damageMultiplier),s=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier>1).sort((e,t)=>t.damageMultiplier-e.damageMultiplier);d3.select("#form-resistances").selectAll("div").remove(),d3.select("#form-weaknesses").selectAll("div").remove(),listTypeEffectivenesses(d3.select("#form-resistances").selectAll("div").data(t).enter(),3*TRANSITION_DELAY),listTypeEffectivenesses(d3.select("#form-weaknesses").selectAll("div").data(s).enter(),4*TRANSITION_DELAY),animateHeight("#form-type-body")}}function listTypeEffectivenesses(e,t){let s=e.append("div").classed("type-label",!0).classed("left",e=>e.damageMultiplier<1).classed("right",e=>e.damageMultiplier>1).attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks").style("background","#222").style("width","48px");fadeInIcon(s.append("img").classed("type-icon",!0).attr("src",e=>"img/types/"+e.attackingType.key+".svg"),(e,s)=>s*TRANSITION_DELAY+t),fadeInText(s.append("div").classed("type-name",!0).classed("type-effectiveness-text",!0).classed("right-aligned",e=>e<1).text(e=>oneDecimal(100*e.damageMultiplier)+"%"),(e,s)=>s*TRANSITION_DELAY+t),s.transition().duration(TRANSITION_DURATION_MEDIUM).delay((e,s)=>s*TRANSITION_DELAY+t).style("background",e=>mixColors("#000",e.attackingType.color,.66)).style("width",e=>172*(e.damageMultiplier>1?e.damageMultiplier/pokedex.maxDamageMultiplier:(1-e.damageMultiplier)/(1-1/pokedex.maxDamageMultiplier))+48+"px")}function updateEvolution(){if(d3.select("#form-evolution-root").selectAll("div").remove(),0===selectedForm.firstAncestor.evolutions.length)return d3.select("#form-evolution-root").html("<br/>No known lineage"),void animateHeight("#form-evolution-body");d3.select("#form-evolution-root").text("");let e=!lastForm||!equivalent(lastForm.firstAncestor.evolutions,selectedForm.firstAncestor.evolutions,"descendant");if(e){d3.select("#form-evolution-root").interrupt().style("transform","scaleX(0)").transition().duration(TRANSITION_DURATION_MEDIUM).ease(d3.easeBack).style("transform","scaleX(1)")}var t=function(s,l){const o=TRANSITION_DURATION_MEDIUM/2;let a=s.append("div").classed("form-evolution-column",!0);if(makePokemonImage(a,{form:l,selected:l.key===selectedForm.key,fadeDelay:o+TRANSITION_DELAY/2*evoFadeDelays++,fadeFrame:e,fadeImage:e,onclick:function(){setSelectedPokemon(l.pokemon,l.pokemon.forms.indexOf(l))}}).classed("form-evolution-descendant-image-wrapper",!0).append("div").classed("form-evolution-descendant-line",!0),0==l.evolutions.length)return;let d=[];for(let e of l.evolutions){if(d.find(t=>t.includes(e)))continue;let t=[e];for(let s of l.evolutions)t.includes(s)||equivalent(e,s,["descendant"])&&t.push(s);d.push(t)}d.length>1&&((a=s.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0),a.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0)),a=s.append("div").classed("form-evolution-column",!0);for(let s=0;s<d.length;++s){const l=d[s],n=l[0],r=d.length>1,i=r&&0==s,c=r&&s==d.length-1;let m=a.append("div").classed("form-evolution-row",!0),p=m.append("div").classed("form-evolution-column",!0);p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",r).classed("top",i).classed("bottom",c),p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",r).classed("top",i).classed("bottom",c),(p=m.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("full",!0).classed("upper",!0).classed("top",i).classed("bottom",c),p.append("div").classed("form-evolution-path",!0).classed("full",!0).classed("lower",!0).classed("top",i).classed("bottom",c);let u=p.append("div").classed("form-evolution-reqs-wrapper",!0).append("div").classed("form-evolution-reqs-body",!0);if(n.requirements.item||n.requirements.timeOfDay||n.requirements.gender){let t=u.append("div").classed("form-evolution-req-icons-wrapper",!0);if(n.requirements.item){let s=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/items/"+n.requirements.item.key+".svg");e&&fadeInIcon(s,o+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.timeOfDay){let s=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.timeOfDay+".svg");e&&fadeInIcon(s,o+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.gender){let s=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.gender+".svg");e&&fadeInIcon(s,o+TRANSITION_DELAY/2*evoFadeDelays++)}}if(n.requirements.buddyDistance){let t=u.append("div").classed("form-evolution-req-label",!0),s=t.append("img").attr("src","img/distance.svg");e&&fadeInIcon(s,o+TRANSITION_DELAY/2*evoFadeDelays++);let l=t.append("div").classed("form-evolution-req-number",!0).text(n.requirements.buddyDistance+" km");e&&fadeInText(l,o+TRANSITION_DELAY/2*evoFadeDelays)}if(n.requirements.other){let t=u.append("div").classed("form-evolution-req-text",!0).text(n.requirements.other);e&&fadeInText(t,o+TRANSITION_DELAY/2*evoFadeDelays)}let f=u.append("div").classed("form-evolution-req-label",!0),v=f.append("img").attr("src","img/candy.svg");e&&fadeInIcon(v,o+TRANSITION_DELAY/2*evoFadeDelays++);let g=f.append("div").classed("form-evolution-req-number",!0).text(n.requirements.candy);if(e&&fadeInText(g,o+TRANSITION_DELAY/2*evoFadeDelays),(p=m.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("top",i).classed("bottom",c),p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("top",i).classed("bottom",c),l.length>1){p=m.append("div").classed("form-evolution-column",!0);let e=m.append("div").classed("form-evolution-column",!0);for(let s=0;s<l.length;++s){const o=l[s],a=0==s,d=s==l.length-1;p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",!0).classed("top",a).classed("bottom",d),p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",!0).classed("top",a).classed("bottom",d),t(e.append("div").classed("form-evolution-row",!0),o.descendant)}}else t(m,n.descendant)}};evoFadeDelays=0,t(d3.select("#form-evolution-root"),selectedForm.firstAncestor),animateHeight("#form-evolution-body")}