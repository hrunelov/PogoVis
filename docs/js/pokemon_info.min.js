/*! PogoVis v0.0.1 | (c) 2020 Hannes RunelÃ¶v | MIT License |  */
var statChart,lastPokemon,selectedPokemon,lastForm,selectedForm,typeChar,evoFadeDelays=0;function setSelectedPokemon(e,t){lastPokemon=selectedPokemon,selectedPokemon=e,updateCaptionPokemon(),setSelectedForm(t||0)}function setSelectedForm(e){lastForm=selectedForm,selectedForm=selectedPokemon.forms[e],d3.select("#form-general-container").node().scrollTo({top:0,behavior:"smooth"}),updateCaptionForm(),updateFormSelectionBar(),updateDescription(),updateTopBar(),updateTypeInfo(),statChart.update(Object.values(selectedForm.baseStats)),updateEvolution()}function updateCaptionPokemon(){d3.select("#pokemon-caption-name").text(selectedPokemon.name),d3.select("#pokemon-caption-category").text(selectedPokemon.category),selectedPokemon.rarity?d3.select("#pokemon-caption-rarity").classed("legendary","legendary"===selectedPokemon.rarity).classed("mythical","mythical"===selectedPokemon.rarity).text(selectedPokemon.rarity).transition().duration(TRANSITION_DURATION_MEDIUM).style("transform","rotate(-45deg) translate(-14px)"):d3.select("#pokemon-caption-rarity").transition().duration(TRANSITION_DURATION_MEDIUM).style("transform","rotate(-45deg) translate(200px)")}function updateCaptionForm(){d3.select("#pokemon-caption").style("background",getTypeSplitColor(selectedForm.types,.8,.6)),d3.select("#pokemon-caption-image-background").style("background",mixColors("#000",selectedForm.types[0].color,.15));let e=POKEMON_IMG_PATH+selectedForm.image+IMG_EXTENSION;e!==d3.select("#pokemon-caption-image").attr("src")&&fadeIn(d3.select("#pokemon-caption-image").interrupt().attr("src",e))}function updateFormSelectionBar(){d3.select("#form-selection-bar").classed("collapsed",1==selectedPokemon.forms.length).classed("expanded",selectedPokemon.forms.length>1).selectAll("div").remove(),1!=selectedPokemon.forms.length&&d3.select("#form-selection-bar").selectAll("div").data(selectedPokemon.forms).enter().append("div").classed("form-selection-button",!0).classed("selected",e=>e.key===selectedForm.key).classed("unselected",e=>e.key!==selectedForm.key).classed("pad-top",!0).classed("pad-left-half",(e,t)=>t>0).classed("pad-right-half",(e,t)=>t<selectedPokemon.forms.length-1).attr("title",e=>selectedPokemon.forms.length<10?"":e.name).style("width",1/selectedPokemon.forms.length*100+"%").style("background",e=>getTypeSplitColor(e.types,.72,e.key===selectedForm.key?.6:.25)).on("mouseover",(function(e){e.key!==selectedForm.key&&d3.select(this).style("background",getTypeSplitColor(e.types,.72,.4))})).on("mouseout",(function(e){e.key!==selectedForm.key&&d3.select(this).style("background",getTypeSplitColor(e.types,.72,.25))})).on("mousedown",(function(e,t){e.key!==selectedForm.key&&setSelectedForm(t)})).append("div").classed("no-letter-spacing",e=>selectedPokemon.forms.length>=10).text(e=>selectedPokemon.forms.length<10?e.name:e.name.substr(0,2))}function updateDescription(){if(!lastForm||lastForm.description!==selectedForm.description){d3.select("#form-description-body").html("<u>"+selectedForm.description+"</u>"),animateHeight("#form-description-body"),clearInterval(typeChar);var e=0;typeChar=setInterval((function(){(e+=2)>selectedForm.description.length&&(e=selectedForm.description.length),d3.select("#form-description-body").html(selectedForm.description.substring(0,e)+"<u>"+selectedForm.description.substring(e)+"</u>"),e===selectedForm.description.length&&clearInterval(typeChar)}),0)}}function updateTopBar(){d3.select("#form-female-percent").text(null!==selectedForm.genderRatio?oneDecimal(100*selectedForm.genderRatio)+"%":"");let e=1===selectedForm.genderRatio?1.01:selectedForm.genderRatio,t=d3.select("#form-female-bar").style("z-index",e>=1?1:0),o=100*e+"%";lastForm&&null!==lastForm.genderRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",o):t.style("width",o),t=d3.select("#form-male-bar").style("z-index",0===e?1:0),o=100-100*Math.min(e,1)+"%",lastForm&&null!==lastForm.genderRatio?t.transition().duration(TRANSITION_DURATION_MEDIUM).style("width",o):t.style("width",o),d3.selectAll(".form-gender-element").classed("hidden",null===selectedForm.genderRatio),d3.select("#form-genderless-label").classed("hidden",null!==selectedForm.genderRatio),d3.select("#form-male-percent").text(null!==selectedForm.genderRatio?100-oneDecimal(100*selectedForm.genderRatio)+"%":"")}function updateTypeInfo(){if(!(lastForm&&lastForm.sameTyping(selectedForm,!0)||(d3.select("#form-types").selectAll("div").remove(),makeTypeLabels(d3.select("#form-types").selectAll("div").data(selectedForm.types).enter(),[selectedForm.types.length>1,!1],2),lastForm&&lastForm.sameTyping(selectedForm,!1)))){var e=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier<1).sort((e,t)=>e.damageMultiplier-t.damageMultiplier),t=selectedForm.counterEffectiveness.filter(e=>e.damageMultiplier>1).sort((e,t)=>t.damageMultiplier-e.damageMultiplier);d3.select("#form-resistances").selectAll("div").remove(),d3.select("#form-weaknesses").selectAll("div").remove(),listTypeEffectiveness(d3.select("#form-resistances").selectAll("div").data(e).enter(),3),listTypeEffectiveness(d3.select("#form-weaknesses").selectAll("div").data(t).enter(),4),animateHeight("#form-type-body")}}function makeTypeLabels(e,t,o){let s=e.append("div").classed("type-label",!0).classed("centered",!0);fadeInIcon(s.append("img").classed("type-icon",!0).attr("src",e=>"img/types/"+e.key+".svg"),(e,t)=>(t+o)*TRANSITION_DELAY),fadeInText(s.append("div").classed("type-name",!0).classed("right-aligned",(e,o)=>t[o]).text(e=>e.name),(e,t)=>(t+o)*TRANSITION_DELAY)}function listTypeEffectiveness(e,t){let o=e.append("div").classed("type-label",!0).classed("left",e=>e.damageMultiplier<1).classed("right",e=>e.damageMultiplier>1).attr("title",e=>oneDecimal(100*e.damageMultiplier)+"% damage from "+e.attackingType.name+"-type attacks").style("background","#222");fadeInIcon(o.append("img").classed("type-icon",!0).attr("src",e=>"img/types/"+e.attackingType.key+".svg"),(e,o)=>(o+t)*TRANSITION_DELAY),fadeInText(o.append("div").classed("type-name",!0).classed("type-effectiveness-text",!0).classed("right-aligned",e=>e<1).text(e=>oneDecimal(100*e.damageMultiplier)+"%"),(e,o)=>(o+t)*TRANSITION_DELAY),o.transition().duration(TRANSITION_DURATION_MEDIUM).delay((e,o)=>(o+t)*TRANSITION_DELAY).style("background",e=>e.damageMultiplier>1?mixColors("#222","#800",(e.damageMultiplier-1)/1.56):mixColors("#222","#060",(1-e.damageMultiplier-.2)/.56))}function updateEvolution(){if(d3.select("#form-evolution-root").selectAll("div").remove(),0===selectedForm.firstAncestor.evolutions.length)return d3.select("#form-evolution-root").html("<br/>No known lineage"),void animateHeight("#form-evolution-body");d3.select("#form-evolution-root").text("");let e=!lastForm||!equivalent(lastForm.firstAncestor.evolutions,selectedForm.firstAncestor.evolutions,"descendant");if(e){d3.select("#form-evolution-root").interrupt().style("transform","scaleX(0)").transition().duration(TRANSITION_DURATION_MEDIUM).ease(d3.easeBack).style("transform","scaleX(1)")}var t=function(o,s){const l=TRANSITION_DURATION_MEDIUM/2;let a=o.append("div").classed("form-evolution-column",!0);if(makePokemonImage(a,75,s,(function(){setSelectedPokemon(s.pokemon,s.pokemon.forms.indexOf(s))}),s.key===selectedForm.key,l+TRANSITION_DELAY/2*evoFadeDelays++,e,e).classed("form-evolution-descendant-image-wrapper",!0).append("div").classed("form-evolution-descendant-line",!0),0==s.evolutions.length)return;let d=[];for(let e of s.evolutions){if(d.find(t=>t.includes(e)))continue;let t=[e];for(let o of s.evolutions)t.includes(o)||equivalent(e,o,["descendant"])&&t.push(o);d.push(t)}d.length>1&&((a=o.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0),a.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0)),a=o.append("div").classed("form-evolution-column",!0);for(let o=0;o<d.length;++o){const s=d[o],n=s[0],r=d.length>1,i=r&&0==o,c=r&&o==d.length-1;let m=a.append("div").classed("form-evolution-row",!0),p=m.append("div").classed("form-evolution-column",!0);p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",r).classed("top",i).classed("bottom",c),p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",r).classed("top",i).classed("bottom",c),(p=m.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("full",!0).classed("upper",!0).classed("top",i).classed("bottom",c),p.append("div").classed("form-evolution-path",!0).classed("full",!0).classed("lower",!0).classed("top",i).classed("bottom",c);let u=p.append("div").classed("form-evolution-reqs-wrapper",!0).append("div").classed("form-evolution-reqs-body",!0);if(n.requirements.item||n.requirements.timeOfDay||n.requirements.gender){let t=u.append("div").classed("form-evolution-req-icons-wrapper",!0);if(n.requirements.item){let o=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/items/"+n.requirements.item.key+".svg");e&&fadeInIcon(o,l+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.timeOfDay){let o=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.timeOfDay+".svg");e&&fadeInIcon(o,l+TRANSITION_DELAY/2*evoFadeDelays++)}if(n.requirements.gender){let o=t.append("img").classed("form-evolution-req-icon",!0).attr("src","img/"+n.requirements.gender+".svg");e&&fadeInIcon(o,l+TRANSITION_DELAY/2*evoFadeDelays++)}}if(n.requirements.buddyDistance){let t=u.append("div").classed("form-evolution-req-label",!0),o=t.append("img").attr("src","img/distance.svg");e&&fadeInIcon(o,l+TRANSITION_DELAY/2*evoFadeDelays++);let s=t.append("div").classed("form-evolution-req-number",!0).text(n.requirements.buddyDistance+" km");e&&fadeInText(s,l+TRANSITION_DELAY/2*evoFadeDelays)}if(n.requirements.other){let t=u.append("div").classed("form-evolution-req-text",!0).text(n.requirements.other);e&&fadeInText(t,l+TRANSITION_DELAY/2*evoFadeDelays)}let f=u.append("div").classed("form-evolution-req-label",!0),v=f.append("img").attr("src","img/candy.svg");e&&fadeInIcon(v,l+TRANSITION_DELAY/2*evoFadeDelays++);let g=f.append("div").classed("form-evolution-req-number",!0).text(n.requirements.candy);if(e&&fadeInText(g,l+TRANSITION_DELAY/2*evoFadeDelays),(p=m.append("div").classed("form-evolution-column",!0)).append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("top",i).classed("bottom",c),p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("top",i).classed("bottom",c),s.length>1){p=m.append("div").classed("form-evolution-column",!0);let e=m.append("div").classed("form-evolution-column",!0);for(let o=0;o<s.length;++o){const l=s[o],a=0==o,d=o==s.length-1;p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("upper",!0).classed("split",!0).classed("top",a).classed("bottom",d),p.append("div").classed("form-evolution-path",!0).classed("short",!0).classed("lower",!0).classed("split",!0).classed("top",a).classed("bottom",d),t(e.append("div").classed("form-evolution-row",!0),l.descendant)}}else t(m,n.descendant)}};evoFadeDelays=0,t(d3.select("#form-evolution-root"),selectedForm.firstAncestor),animateHeight("#form-evolution-body")}statChart=new SpiderChart(d3.select("#form-stats-body"),"form-stats-shape",280,200,500,100,["Stamina","Attack","Defense"]);