/*! PogoVis v0.0.1 | (c) 2020 Hannes RunelÃ¶v | MIT License |  */
const CHARGES=6,PVE="gymsAndRaids",PVP="trainerBattles";var selectedMove,collapsedHeights=d3.local();function updateMoveInfo(){updateChargedMoves(PVP),updateFastMoves(PVP)}function updateFastMoves(e){const t=e===PVE?"duration":"turns",a=e===PVE?"energyPerSecond":"energyPerTurn";listData({data:selectedForm.movePool.fast.sort((t,a)=>a.move.stats[e].damagePerSecond*a.move.stats[e].energyPerSecond*(selectedForm.types.includes(a.move.type)?1.2:1)-t.move.stats[e].damagePerSecond*t.move.stats[e].energyPerSecond*(selectedForm.types.includes(t.move.type)?1.2:1)),key:e=>e.move.key,container:d3.select("#form-fast-moves"),classed:"form-move-wrapper",fade:!0,waitForExit:!0,duration:TRANSITION_DURATION_MEDIUM,onenter:function(o,s){let l=e=>mixColors("#222",e.move.type.color,.25);(o=appendMoveBody(o,s)).classed("fast",!0);let r=o.appendBar({max:e===PVE?5:4,minorTickStep:1,majorTickStep:a=>a.move.stats[e][t],maxMajorTick:a=>a.move.stats[e][t],majorTickOpacity:0,labels:a=>[" ",a.move.stats[e][t]+(e===PVE?" s":a.move.stats[e][t]>1?" turns":" turn")],labelAnchor:"end"}).classed("duration-bar",!0);r.appendBarValue({value:a=>a.move.stats[e][t],color:e=>e.move.type.color}),r.appendBarValue({startValue:t=>t.move.stats[e].damageWindow.start*(e===PVE?1:2),value:t=>t.move.stats[e].damageWindow.end*(e===PVE?1:2),color:e=>mixColors(e.move.type.color,"#fff",.5),shadow:!0});let i=r.appendBarValue({value:0,shadow:!0}).classed("sim-value",!0),d=o.appendBar({height:t=>2+t.move.stats[e].power/20*48,max:25*(e===PVE?1:2),minorTickStep:5,minorTickOpacity:0,majorTickStep:t=>.01*t.move.stats[e].energyGain*(100/t.move.stats[e][a]),maxMajorTick:t=>100/t.move.stats[e][a]}).classed("energy-bar",!0);d.appendBarValue({value:t=>100/t.move.stats[e][a],color:e=>e.move.type.color,shadow:!0});let n=d.appendBarValue({value:0,shadow:!0}).classed("sim-value",!0);o.on("mouseenter",(function(t,a){let o=d3.select("#form-charged-moves").selectAll(".form-move-body").select(".energy-bar");d3.select("#form-fast-moves").selectAll(".form-move-body").filter(e=>e.move.key!==t.move.key).transition("dim").duration(TRANSITION_DURATION_FAST).style("opacity",.5),o.setBarTickStep({minorTickStep:t.move.stats[e].energyGain,labels:a=>["FASTS",Math.ceil(a.move.stats[e].energyCost/t.move.stats[e].energyGain),Math.ceil(2*a.move.stats[e].energyCost/t.move.stats[e].energyGain),Math.ceil(3*a.move.stats[e].energyCost/t.move.stats[e].energyGain)]}),o.select("svg").selectAll("text").transition().duration(TRANSITION_DURATION_FAST).style("fill","#fff")})).on("click",(function(o,s){if(d3.select(this).classed("selected"))return;d3.select(this).classed("selected",!0);let l=n.at(s),r=i.at(s),d=d3.select("#form-charged-moves").selectAll(".form-move-body"),c=d.select(".energy-bar"),m=c.select("svg").select("g").select(".sim-value"),v=c.select("svg").select("g").select(".charged-value");d.selectAll(".form-move-body > div:not(.energy-bar)").transition().duration(TRANSITION_DURATION_FAST).style("opacity",.5);let p=0;(function s(){p+=o.move.stats[e].energyGain,nrgCapped=Math.min(p,100);let i=1e3*o.move.stats[e].duration,n=1e3*o.move.stats[e].damageWindow.start,c=1e3*o.move.stats[e].damageWindow.end,y=o.move.stats[e].energyGain;l.setBarValue({value:t=>.01*nrgCapped*(100/t.move.stats[e][a]),duration:250,delay:n,ease:d3.easeExpOut}),r.setBarValue({startValue:0,value:.05,immediate:!0}).setBarValue({startValue:o.move.stats[e][t]-.05,value:o.move.stats[e][t],duration:i,ease:d3.easeLinear}),d.transition().duration(0).delay(n).style("background",t=>p>y&&p%t.move.stats[e].energyCost<y?t.move.type.color:p>=t.move.stats[e].energyCost?mixColors("#222",t.move.type.color,.5):mixColors("#222",t.move.type.color,.25)).transition().duration(500).ease(d3.easeQuadOut).style("background",t=>p>=t.move.stats[e].energyCost?mixColors("#222",t.move.type.color,.5):mixColors("#222",t.move.type.color,.25)),d.selectAll(".form-move-body > div:not(.energy-bar)").transition().duration(TRANSITION_DURATION_FAST).delay(n).style("opacity",t=>p>=t.move.stats[e].energyCost?1:.5),m.setBarValue({value:nrgCapped,duration:250,delay:n,ease:d3.easeExpOut}),v.setBarValue({value:t=>t.move.stats[e].energyCost*Math.floor(nrgCapped/t.move.stats[e].energyCost),duration:500,delay:n,ease:d3.easeExpOut}),d3.select(this).transition().duration(0).delay(n).style("background",o.move.type.color),d3.select(this).transition().duration(c-n).delay(n+1).ease(d3.easeQuadOut).style("background",e=>mixColors("#222",e.move.type.color,.25)),d3.select("body").transition().duration(i).on("end",function(){p<100?s.bind(this)():r.setBarValue({value:0,immediate:!0})}.bind(this))}).bind(this)()})).on("mouseleave",(function(){d3.select(this).classed("selected",!1),d3.select("body").interrupt(),d3.select("#form-fast-moves").selectAll(".form-move-body").transition("dim").duration(TRANSITION_DURATION_FAST).style("opacity",1),d3.select(this).select(".energy-bar").select("svg").select("g").select(".sim-value").setBarValue({value:0,duration:TRANSITION_DURATION_FAST}),d3.select(this).transition().duration(TRANSITION_DURATION_FAST).style("background",l),d3.select(this).select(".duration-bar").select("svg").select("g").select(".sim-value").setBarValue({value:0,immediate:!0});let e=d3.select("#form-charged-moves").selectAll(".form-move-body"),t=e.select(".energy-bar");e.selectAll("div:not(.energy-bar)").transition().duration(TRANSITION_DURATION_FAST).style("opacity",1),t.setBarTickStep({minorTickStep:0,labels:["ENERGY"]}),t.select("svg").selectAll("text").transition().duration(TRANSITION_DURATION_FAST).style("fill","#fff8"),t.select("svg").select("g").selectAll(".sim-value,.charged-value").setBarValue({value:0,duration:TRANSITION_DURATION_FAST}),e.transition().duration(TRANSITION_DURATION_FAST).style("background",e=>mixColors("#222",e.move.type.color,.25))}))},onupdate:function(e,t){updateMoveCaption(e)},onexit:function(e,t){tearDownMoveCaption(e,t)}})}function updateChargedMoves(e){listData({data:selectedForm.movePool.charged.sort((t,a)=>a.move.stats[e].damagePerEnergy*(selectedForm.types.includes(a.move.type)?1.2:1)*(e===PVE?a.move.stats[e].damagePerSecond*(selectedForm.types.includes(a.move.type)?1.2:1):1)-t.move.stats[e].damagePerEnergy*(selectedForm.types.includes(t.move.type)?1.2:1)*(e===PVE?t.move.stats[e].damagePerSecond*(selectedForm.types.includes(t.move.type)?1.2:1):1)),key:e=>e.move.key,container:d3.select("#form-charged-moves"),classed:"form-move-wrapper",fade:!0,waitForExit:!0,duration:TRANSITION_DURATION_MEDIUM,onenter:function(t,a){if(t=appendMoveBody(t,a),e===PVE){let a=t.appendBar({max:5,minorTickStep:1,majorTickStep:t=>t.move.stats[e].duration,maxMajorTick:t=>t.move.stats[e].duration,majorTickOpacity:0,labels:t=>[" ",t.move.stats[e].duration+" s"],labelAnchor:"end"}).classed("duration-bar",!0);a.appendBarValue({value:t=>t.move.stats[e].duration,color:e=>e.move.type.color}),a.appendBarValue({startValue:t=>t.move.stats[e].damageWindow.start,value:t=>t.move.stats[e].damageWindow.end,color:e=>mixColors(e.move.type.color,"#fff",.5),shadow:!0})}let o=t.appendBar({height:t=>2+t.move.stats[e].power/200*48,background:e=>e.move.type.color,max:100,majorTickStep:t=>t.move.stats[e].energyCost,labels:["ENERGY"]}).classed("energy-bar",!0);o.appendBarValue({value:0,color:e=>mixColors(e.move.type.color,"#fff",.5),shadow:!0}).classed("sim-value",!0);o.appendBarValue({value:0,color:"#fff"}).classed("charged-value",!0)},onupdate:function(e,t){updateMoveCaption(e)},onexit:function(e,t){tearDownMoveCaption(e,t)}})}function appendMoveBody(e,t){(e=e.append("div").classed("form-move-body",!0).classed("special",e=>e.availability).style("background",e=>mixColors("#222",e.move.type.color,.25))).append("div").attr("class",e=>"form-move-availability-label "+(e.availability?e.availability:"")).text(e=>e.availability);let a=e.append("div").classed("form-move-caption",!0);return a.appendTypeIcon(e=>e.move.type).attr("title",e=>e.move.type.name+" type move"),a.append("div").classed("caption",!0).text(e=>e.move.name),e}function appendMoveEffectiveness(e,t){e.append("div").classed("move-details",!0).classed("sub-caption",!0).classed("left-aligned",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier>1)).text("Super Effective against"),e.append("div").classed("move-details",!0).classed("form-move-array",!0).classed("form-move-array-types",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier>1)).selectAll("div").data(e=>e.move.type.effectiveness.filter(e=>e.damageMultiplier>1)).enter().append("div").classed("form-move-array-type-icon",!0).appendTypeIcon(e=>e.defendingType),e.append("div").classed("move-details",!0).classed("sub-caption",!0).classed("left-aligned",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<1&&e.damageMultiplier>.6)).text("Not Very Effective against"),e.append("div").classed("move-details",!0).classed("form-move-array",!0).classed("form-move-array-types",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<1&&e.damageMultiplier>.6)).selectAll("div").data(e=>e.move.type.effectiveness.filter(e=>e.damageMultiplier<1&&e.damageMultiplier>.6)).enter().append("div").classed("form-move-array-type-icon",!0).appendTypeIcon(e=>e.defendingType),e.append("div").classed("move-details",!0).classed("sub-caption",!0).classed("left-aligned",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<.6)).text("Ineffective against"),e.append("div").classed("move-details",!0).classed("form-move-array",!0).classed("form-move-array-types",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<.6)).selectAll("div").data(e=>e.move.type.effectiveness.filter(e=>e.damageMultiplier<.6)).enter().append("div").classed("form-move-array-type-icon",!0).appendTypeIcon(e=>e.defendingType),e.selectAll(".remove").remove()}function updateMoveCaption(e){e.select(".form-move-body").classed("special",e=>e.availability).select(".form-move-availability-label").attr("class",e=>"form-move-availability-label "+(e.availability?e.availability:"")).text(e=>e.availability)}function tearDownMoveCaption(e,t){let a=(e=e.select(".form-move-body")).select(".form-move-caption");a.select(".type-icon").zoomOut({delay:t}),a.select(".caption").zoomOutY({delay:t})}function tearDownMoveEffectiveness(e){e.selectAll(".move-details").remove()}new ResizeObserver(function(){d3.selectAll(".form-move-column").style("max-height",d3.select("#form-move-info-page").node().offsetHeight-.5*d3.select(".form-move-column").node().offsetTop+.5*d3.select("#form-selection-bar").node().offsetHeight-12+"px")}).observe(d3.select("#form-move-info-page").node());