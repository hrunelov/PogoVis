/*! PogoVis v0.0.1 | (c) 2020 Hannes RunelÃ¶v | MIT License |  */
const CHARGES=6,PVE="gymsAndRaids",PVP="trainerBattles";var selectedMove,collapsedHeights=d3.local();function updateMoveInfo(){updateChargedMoves(PVP),updateFastMoves(PVP)}function updateFastMoves(e){const t=e===PVE?"duration":"turns",a=e===PVE?"energyPerSecond":"energyPerTurn";listData({data:selectedForm.movePool.fast.sort((t,a)=>a.move.stats[e].damagePerSecond*a.move.stats[e].energyPerSecond*(selectedForm.types.includes(a.move.type)?1.2:1)-t.move.stats[e].damagePerSecond*t.move.stats[e].energyPerSecond*(selectedForm.types.includes(t.move.type)?1.2:1)),key:e=>e.move.key,container:d3.select("#form-fast-moves"),classed:"form-move-wrapper",fade:!0,waitForExit:!0,duration:TRANSITION_DURATION_MEDIUM,onenter:function(o,s){let l=e=>mixColors("#222",e.move.type.color,.25),i=(o=appendMoveCaption(o,s)).appendBar({max:e===PVE?5:4,minorTickStep:1,majorTickStep:a=>a.move.stats[e][t],maxMajorTick:a=>a.move.stats[e][t],majorTickOpacity:0,labels:a=>[" ",a.move.stats[e][t]+(e===PVE?" s":a.move.stats[e][t]>1?" turns":" turn")],labelAnchor:"end"}).classed("duration-bar",!0);i.appendBarValue({value:a=>a.move.stats[e][t],color:e=>e.move.type.color}),i.appendBarValue({startValue:t=>t.move.stats[e].damageWindow.start*(e===PVE?1:2),value:t=>t.move.stats[e].damageWindow.end*(e===PVE?1:2),color:e=>mixColors(e.move.type.color,"#fff",.5),shadow:!0});let r=i.appendBarValue({value:0,shadow:!0}).classed("sim-value",!0),n=o.appendBar({height:t=>2+t.move.stats[e].power/20*48,max:25*(e===PVE?1:2),minorTickStep:5,minorTickOpacity:0,majorTickStep:t=>.01*t.move.stats[e].energyGain*(100/t.move.stats[e][a]),maxMajorTick:t=>100/t.move.stats[e][a]}).classed("energy-bar",!0);n.appendBarValue({value:t=>100/t.move.stats[e][a],color:e=>e.move.type.color,shadow:!0});let d=n.appendBarValue({value:0,shadow:!0}).classed("sim-value",!0),m=d3.select("#form-charged-moves").selectAll(".form-move-body"),c=m.select(".energy-bar"),v=c.select("svg").select("g").select(".sim-value"),p=c.select("svg").select("g").select(".charged-value");o.on("mouseenter",(function(t,a){d3.select("#form-fast-moves").selectAll(".form-move-body").filter(e=>e.move.key!==t.move.key).transition("dim").duration(TRANSITION_DURATION_FAST).style("opacity",.5),c.setBarTickStep({minorTickStep:t.move.stats[e].energyGain,labels:a=>["FASTS",Math.ceil(a.move.stats[e].energyCost/t.move.stats[e].energyGain),Math.ceil(2*a.move.stats[e].energyCost/t.move.stats[e].energyGain),Math.ceil(3*a.move.stats[e].energyCost/t.move.stats[e].energyGain)]}),c.select("svg").selectAll("text").transition().duration(TRANSITION_DURATION_FAST).style("fill","#fff")})).on("click",(function(o,s){let l=d.at(s),i=r.at(s);m.selectAll(".form-move-body > div:not(.energy-bar)").transition().duration(TRANSITION_DURATION_FAST).style("opacity",.5);let n=0;(function s(){n+=o.move.stats[e].energyGain,nrgCapped=Math.min(n,100);let r=1e3*o.move.stats[e].duration,d=1e3*o.move.stats[e].damageWindow.start,c=1e3*o.move.stats[e].damageWindow.end,u=o.move.stats[e].energyGain;l.setBarValue({value:t=>.01*nrgCapped*(100/t.move.stats[e][a]),duration:250,delay:d,ease:d3.easeExpOut}),i.setBarValue({startValue:0,value:.05,immediate:!0}).setBarValue({startValue:o.move.stats[e][t]-.05,value:o.move.stats[e][t],duration:r,ease:d3.easeLinear}),m.transition().duration(0).delay(d).style("background",t=>n>u&&n%t.move.stats[e].energyCost<u?t.move.type.color:n>=t.move.stats[e].energyCost?mixColors("#222",t.move.type.color,.5):mixColors("#222",t.move.type.color,.25)).transition().duration(500).ease(d3.easeQuadOut).style("background",t=>n>=t.move.stats[e].energyCost?mixColors("#222",t.move.type.color,.5):mixColors("#222",t.move.type.color,.25)),m.selectAll(".form-move-body > div:not(.energy-bar)").transition().duration(TRANSITION_DURATION_FAST).delay(d).style("opacity",t=>n>=t.move.stats[e].energyCost?1:.5),v.setBarValue({value:nrgCapped,duration:250,delay:d,ease:d3.easeExpOut}),p.setBarValue({value:t=>t.move.stats[e].energyCost*Math.floor(nrgCapped/t.move.stats[e].energyCost),duration:500,delay:d,ease:d3.easeExpOut}),d3.select(this).transition().duration(0).delay(d).style("background",o.move.type.color),d3.select(this).transition().duration(c-d).delay(d+1).ease(d3.easeQuadOut).style("background",e=>mixColors("#222",e.move.type.color,.25)),d3.select("body").transition().duration(r).on("end",function(){n<100?s.bind(this)():i.setBarValue({value:0,immediate:!0})}.bind(this))}).bind(this)()})).on("mouseleave",(function(){d3.select("body").interrupt(),d3.select("#form-fast-moves").selectAll(".form-move-body").transition("dim").duration(TRANSITION_DURATION_FAST).style("opacity",1),d3.select(this).select(".energy-bar").select("svg").select("g").select(".sim-value").setBarValue({value:0,duration:TRANSITION_DURATION_FAST}),d3.select(this).transition().duration(TRANSITION_DURATION_FAST).style("background",l),d3.select(this).select(".duration-bar").select("svg").select("g").select(".sim-value").setBarValue({value:0,immediate:!0});let e=d3.select("#form-charged-moves").selectAll(".form-move-body"),t=e.select(".energy-bar");e.selectAll("div:not(.energy-bar)").transition().duration(TRANSITION_DURATION_FAST).style("opacity",1),t.setBarTickStep({minorTickStep:0,labels:["ENERGY"]}),t.select("svg").selectAll("text").transition().duration(TRANSITION_DURATION_FAST).style("fill","#fff8"),t.select("svg").select("g").selectAll(".sim-value,.charged-value").setBarValue({value:0,duration:TRANSITION_DURATION_FAST}),e.transition().duration(TRANSITION_DURATION_FAST).style("background",e=>mixColors("#222",e.move.type.color,.25))}))},onupdate:function(e,t){updateMoveCaption(e)},onexit:function(e,t){tearDownMoveCaption(e,t)}})}function updateChargedMoves(e){listData({data:selectedForm.movePool.charged.sort((t,a)=>a.move.stats[e].damagePerEnergy*(selectedForm.types.includes(a.move.type)?1.2:1)*(e===PVE?a.move.stats[e].damagePerSecond*(selectedForm.types.includes(a.move.type)?1.2:1):1)-t.move.stats[e].damagePerEnergy*(selectedForm.types.includes(t.move.type)?1.2:1)*(e===PVE?t.move.stats[e].damagePerSecond*(selectedForm.types.includes(t.move.type)?1.2:1):1)),key:e=>e.move.key,container:d3.select("#form-charged-moves"),classed:"form-move-wrapper",fade:!0,waitForExit:!0,duration:TRANSITION_DURATION_MEDIUM,onenter:function(t,a){if(t=appendMoveCaption(t,a),e===PVE){let a=t.appendBar({max:5,minorTickStep:1,majorTickStep:t=>t.move.stats[e].duration,maxMajorTick:t=>t.move.stats[e].duration,majorTickOpacity:0,labels:t=>[" ",t.move.stats[e].duration+" s"],labelAnchor:"end"}).classed("duration-bar",!0);a.appendBarValue({value:t=>t.move.stats[e].duration,color:e=>e.move.type.color}),a.appendBarValue({startValue:t=>t.move.stats[e].damageWindow.start,value:t=>t.move.stats[e].damageWindow.end,color:e=>mixColors(e.move.type.color,"#fff",.5),shadow:!0})}let o=t.appendBar({height:t=>2+t.move.stats[e].power/200*48,background:e=>e.move.type.color,max:100,majorTickStep:t=>t.move.stats[e].energyCost,labels:["ENERGY"]}).classed("energy-bar",!0);o.appendBarValue({value:0,color:e=>mixColors(e.move.type.color,"#fff",.5),shadow:!0}).classed("sim-value",!0);o.appendBarValue({value:0,color:"#fff"}).classed("charged-value",!0)},onupdate:function(e,t){updateMoveCaption(e)},onexit:function(e,t){tearDownMoveCaption(e,t)}})}function appendMoveCaption(e,t){(e=e.append("div").classed("form-move-body",!0).classed("special",e=>e.availability).style("background",e=>mixColors("#222",e.move.type.color,.25))).append("div").attr("class",e=>"form-move-availability-label "+(e.availability?e.availability:"")).text(e=>e.availability);let a=e.append("div").classed("form-move-caption",!0).zoomInY({delay:t});return a.appendTypeIcon(e=>e.move.type).attr("title",e=>e.move.type.name+" type move").zoomIn({delay:t}),a.append("div").classed("caption",!0).text(e=>e.move.name).zoomInY({delay:t}),e}function appendMoveEffectiveness(e,t){e.append("div").classed("move-details",!0).classed("sub-caption",!0).classed("left-aligned",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier>1)).text("Super Effective against"),e.append("div").classed("move-details",!0).classed("form-move-array",!0).classed("form-move-array-types",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier>1)).selectAll("div").data(e=>e.move.type.effectiveness.filter(e=>e.damageMultiplier>1)).enter().append("div").classed("form-move-array-type-icon",!0).appendTypeIcon(e=>e.defendingType),e.append("div").classed("move-details",!0).classed("sub-caption",!0).classed("left-aligned",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<1&&e.damageMultiplier>.6)).text("Not Very Effective against"),e.append("div").classed("move-details",!0).classed("form-move-array",!0).classed("form-move-array-types",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<1&&e.damageMultiplier>.6)).selectAll("div").data(e=>e.move.type.effectiveness.filter(e=>e.damageMultiplier<1&&e.damageMultiplier>.6)).enter().append("div").classed("form-move-array-type-icon",!0).appendTypeIcon(e=>e.defendingType),e.append("div").classed("move-details",!0).classed("sub-caption",!0).classed("left-aligned",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<.6)).text("Ineffective against"),e.append("div").classed("move-details",!0).classed("form-move-array",!0).classed("form-move-array-types",!0).classed("remove",e=>!e.move.type.effectiveness.find(e=>e.damageMultiplier<.6)).selectAll("div").data(e=>e.move.type.effectiveness.filter(e=>e.damageMultiplier<.6)).enter().append("div").classed("form-move-array-type-icon",!0).appendTypeIcon(e=>e.defendingType),e.selectAll(".remove").remove()}function updateMoveCaption(e){e.select(".form-move-body").classed("special",e=>e.availability).select(".form-move-availability-label").attr("class",e=>"form-move-availability-label "+(e.availability?e.availability:"")).text(e=>e.availability)}function tearDownMoveCaption(e,t){let a=(e=e.select(".form-move-body")).select(".form-move-caption");a.select(".type-icon").zoomOut({delay:t}),a.select(".caption").zoomOutY({delay:t})}function tearDownMoveEffectiveness(e){e.selectAll(".move-details").remove()}new ResizeObserver(function(){d3.selectAll(".form-move-column").style("max-height",d3.select("#form-move-info-page").node().offsetHeight-.5*d3.select(".form-move-column").node().offsetTop+.5*d3.select("#form-selection-bar").node().offsetHeight-12+"px")}).observe(d3.select("#form-move-info-page").node());